# popup

Блок `popup` используется для создания выпадающих элементов и позволяет изменять их состояние, поведение и внешний вид. Блок всегда отображается поверх остальных элементов страницы.

Попап может быть вызван различными элементами страницы, например, кнопками или псевдоссылками.

При первом открытии попапа DOM-элемент блока переносится в конце `<body>`. Блок получает модификатор `visible`.

## Инициализация блока

Чтобы попап отображался при установке модификатора `visible`, блок должен быть предварительно инициализирован. Для этого служит метод `setTarget`. В ходе выполнения методу необходимо определить положение попапа на странице. Это может осуществляться:

* исходя из положения на странице родительского элемента. В этом случае методу `setTarget` следует передать аргументом родительский DOM-элемент или БЭМ-блок;
* путем явного указания координат. Первым аргументом методу `setTarget` передается значение отступа от левого края страницы, вторым отступ сверху: `setTarget(x-coordinate, y-coordinate)`.

Метод `setTarget` возвращает объект `this`.

## Краткая инфорция

### Специализированные поля блока

Список зарезервированных полей входного BEMJSON:

| Field | Type | Description |
| ---- | --- | -------- |
| <a href=#directions>directions</a> | <code>Array</code> | Управляет <a href="directions">направлением открытия попапа</a> (например, <code>bottom-left</code>, где <code>bottom</code> является основным параметром, <code>left</code> - второстепенным) на странице относительно вызвавшего его элемета. |
| <a href=#mainOffset>mainOffset</a> | <code>String</code> | Задает смещение попапа относительно основного направления.|
| <a href=#mainOffset>secondaryOffset</a> | <code>String</code>| Задает смещение попапа относительно второстепенного направления. |
| viewportOffset | <code>String</code>| Задает смещение попапа от края окна браузера.|
| zIndexGroupLevel | <code>String</code> | Позволяет задать уровень слоя для открывающихся попапов. Основан на блоке <a href="../z-index-group/z-index.group.ru.md">z-index-group</a>|


При необходимости дополнительные HTML-атрибуты блока могут быть заданы в зарезервированном поле `attrs` в BEMJSON.

### Модификаторы блока

| Модификатор | Допустимое значение | Способ использования | Описание |
| ----------- | ------------------- | -------------------- | -------- |
| <a href=#popuptheme>theme</a> | <code>'simple'</code>, <code>'normal'</code> | <code>BEMJSON</code> | Стилевое оформление. |
| <a href=#popupvisible>visible</a> | | | |
| <a href=#popupautoscalable>autoscalable</a> | <code>'true'</code>| <code>BEMJSON</code> | |

<a name="popuptheme"></a>

### Модификатор `theme`

Допустимое значение: `'simple'`, `'normal'`.

Способы использования:

Без указания модификатора `theme` отображается [нативный](#native) вид контрола.

Пример:

<a name="native"></a>


```
{
    block : 'popup',
    content : 'default'
}
```


```
{
    block : 'popup',
    mods : { theme : 'simple' },
    content : 'simple'
}
```


```
{
    block : 'popup',
    mods : { theme : 'normal' },
    content : 'normal'
}
```
<a name="popupvisible"></a>

### Модификатор `visible`

Модификатор `visible` выставляется блоку автоматически при открытии попапа. Когда попап скрыт, модификатор удаляется.

**NB:** данная реализация блока не поддерживает принудительную установку модификатора `visible` в BEMJSON-декларации.

<a name="popupautoscalable"></a>

#### Модификатор `autoscalable`

Допустимые значения: `'true'`

Способы использования:

Модификатор `autoscalable` скрывает блок по щелчку мыши вне зоны попапа.

```
{
    block : 'popup',
    mods : { theme : 'normal', autoclosable : true },
    content : 'normal'
}
```

<a name="directions"></a>

## Расположение относительно родителя `direction`

Поле `direction` управляет направлением открытия попапа на странице относительно вызвавшего его элемета. Расположение блока определяется автоматически, исходя из массива допустимых направлений и положения родителя на странице.

По умолчанию используется следующий массив допустимых направлений:

* bottom-left
* bottom-center
* bottom-right
* top-left
* top-center
* top-right
* right-top
* right-center
* right-bottom
* left-top
* left-center
* left-bottom

Чтобы управлять расположением попапа, можно ограничить массив направлений открытия, оставив только требуемые. Пользовательский массив нужно передать в качестве JS-параметра с ключом `directions`. При этом из значений массива будет выбрано наиболее подходящее, исходя из положения родителя на странице.

Например, если требуется, чтобы попап раскрывался над родителем:

```
{
    block : 'popup',
    mods : { autoclosable : true, theme: 'simple' },
    directions : ['top-left', 'top-center', 'top-right'],
    content : 'Popup message'
}
```

Или небходимо разместить попап справа по центру:

```
{
    block : 'popup',
    mods : { autoclosable : true, theme: 'simple' },
    directions : ['right-center'],
    content : 'Popup message'
}
```
<a name="mainOffset"></a>

Используйте поля `mainOffset` и/или `secondaryOffset` для управления направлением смещения.

```
{
    block : 'popup',
    mods : { autoclosable : true, theme: 'normal' },
    direction : ['right-center'],
    mainOffset : 100,
    secondaryOffset : 100,
    content : 'Popup message'
}
```

## Взаимосвязи между popup'ами

Блок `popup` поддерживает вложенную структуру нескольких одновременно открытых попапов. Это означает, что один попап может вызывать второй, а второй, соответственно, может вызвать третий и так далее. И при этом все попапы будут оставаться открытыми.

Если установлен модификатор `autoscalable` в значении `true`, то при щелчке мышью вне зоны попапа, попап закроется сам и закроет свои дочерние блоки.

Дочерние блоки popup можно рассматривать в виде цепочки `1` → `2` → `3` → `4`. При клике на втором попапе – закрываются третий и четвертый. При клике в первом – закрываются второй, третий, четвертый. При клике за пределами любого попапа из цепочки – закроются все.
